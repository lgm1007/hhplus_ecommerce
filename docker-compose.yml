networks:
  grafana:

services:
  # Redis ì„¤ì •
  redis1:
    image: redis
    container_name: redis1
    ports:
      - '6379:6379'

  # Zookeeper 1 ì„œë¹„ìŠ¤ ì„¤ì •ì…ë‹ˆë‹¤.
  zookeeper1:
    image: 'bitnami/zookeeper:3.8.1'
    hostname: 'zookeeper1'
    ports:
      - '2181:2181'  # í˜¸ìŠ¤íŠ¸ì™€ ì»¨í…Œì´ë„ˆ ê°„ì˜ í¬íŠ¸ í¬ì›Œë”©: í˜¸ìŠ¤íŠ¸ì˜ 2181 í¬íŠ¸ì™€ ì»¨í…Œì´ë„ˆì˜ 2181 í¬íŠ¸ ê°„ì— í†µì‹ ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.
    environment:
      - ZOO_SERVER_ID=1  # Zookeeper ì„œë²„ ID
      # ë¦¬ë” ì„ ì¶œ ë° ì¿¼ëŸ¼ í†µì‹ ì„ ìœ„í•œ ì„œë²„ ID, í˜¸ìŠ¤íŠ¸ëª… ë° í¬íŠ¸ë¥¼ ì§€ì •í•œ Zookeeper ì•™ìƒë¸” êµ¬ì„±
      - ZOO_SERVERS=zookeeper1:2888:3888::1
      - ALLOW_ANONYMOUS_LOGIN=yes  # ìµëª… ë¡œê·¸ì¸ í—ˆìš© ì„¤ì •
    user: root  # ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ ì‚¬ìš©í•  ì‚¬ìš©ì
  # Kafka ë¸Œë¡œì»¤ 1
  kafka1:
    image: 'bitnami/kafka:3.5.1'
    hostname: 'kafka1'
    ports:
      - '9092:9092'    # í˜¸ìŠ¤íŠ¸ í¬íŠ¸ì™€ ì»¨í…Œì´ë„ˆ í¬íŠ¸ ê°„ì˜ í¬íŠ¸ í¬ì›Œë”© ì„¤ì •: í˜¸ìŠ¤íŠ¸ì˜ 9092 í¬íŠ¸ì™€ ì»¨í…Œì´ë„ˆì˜ 9092 í¬íŠ¸ ê°„ì— í†µì‹ ì´ ì´ë£¨ì–´ì§
      - '9094:9094'
    environment:
      - KAFKA_BROKER_ID=1    # Kafka ë¸Œë¡œì»¤ ID
      - ALLOW_PLAINTEXT_LISTENER=yes    # PLAINTEXT ë¦¬ìŠ¤ë„ˆ í—ˆìš© ì„¤ì • (yes : ë³´ì•ˆ ì—†ì´ ì ‘ì† ê°€ëŠ¥)
      - KAFKA_ENABLE_KRAFT=no    # Kafka KRaft í™œì„±í™” ì—¬ë¶€ ì„¤ì • (no : Zookeeper ì‚¬ìš©/ yes : Zookeeper ì‚¬ìš©x)
#      - KAFKA_CFG_NODE_ID=1   # KRaft mode ì—ì„œ uniqueí•œ node id í•„ìš”    ğŸ‘‰ KRaft ê´€ë ¨ ì„¤ì •ìœ¼ë¡œ Zookeeper ì‚¬ìš© Xì¼ ë•Œ ì‚¬ìš©
      - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=PLAINTEXT:PLAINTEXT,INTERNAL:PLAINTEXT
      - KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,INTERNAL://:9094    # Kafka ë¸Œë¡œì»¤ ë¦¬ìŠ¤ë„ˆ ì„¤ì • (Kafka ë‚´ë¶€/ì™¸ë¶€ì—ì„œ ì ‘ì†í•  ì •ë³´)
      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://127.0.0.1:9092,INTERNAL://kafka1:9094
#      - KAFKA_CFG_PROCESS_ROLES=broker    # Kafka requires at least one process role    ğŸ‘‰ KRaft ê´€ë ¨ ì„¤ì •ìœ¼ë¡œ Zookeeper ì‚¬ìš© Xì¼ ë•Œ ì‚¬ìš©
      - KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper1:2181  #ZooKeeperì˜ ì£¼ì†Œë¥¼ KAFKA_CFG_ZOOKEEPER_CONNECT í™˜ê²½ ë³€ìˆ˜ì— ì„¤ì •
      - KAFKA_CFG_INTER_BROKER_LISTENER_NAME=INTERNAL
    depends_on:
      - zookeeper1
    user: root    # ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ ì‚¬ìš©í•  ì‚¬ìš©ì

  # Kafka UI
  kafka-ui:
    image: provectuslabs/kafka-ui
    hostname: kafka-ui
    ports:
      #ì„œë²„ì˜ 8989í¬íŠ¸ë¥¼ ë„ì»¤ì»¨í…Œì´ë„ˆì˜ 8080í¬íŠ¸ì™€ ì—°ê²° (ì´ê±° í•˜ë©´ ëš«ë¦¼!!ê¸°ë³¸ì´ 8080ì œê³µì¸ë°, ë‚´ê°€ 8080ì€ ë„ˆë¬´ ë§ì´ ì“°ë‹ˆê¹Œ 8089ë¡œ ì¼ë¶€ëŸ¬ ë°”ê¾¼ ì„¤ì •!)
      - "8989:8080"    # í˜¸ìŠ¤íŠ¸ í¬íŠ¸ì™€ ì»¨í…Œì´ë„ˆ í¬íŠ¸ ê°„ì˜ í¬íŠ¸ í¬ì›Œë”© ì„¤ì •: í˜¸ìŠ¤íŠ¸ì˜ 8989 í¬íŠ¸ì™€ ì»¨í…Œì´ë„ˆì˜ 8080 í¬íŠ¸ ê°„ì— í†µì‹ ì´ ì´ë£¨ì–´ì§
    environment:
      - KAFKA_CLUSTERS_0_NAME=kafka1    # Kafka í´ëŸ¬ìŠ¤í„° ì´ë¦„ ì„¤ì •
      - KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=kafka1:9094  # Kafka í´ëŸ¬ìŠ¤í„° ë¶€íŠ¸ìŠ¤íŠ¸ë© ì„œë²„ ì„¤ì •
      - KAFKA_CLUSTERS_0_ZOOKEEPER=zookeeper1:2181
  grafana:
    image: grafana/grafana:9.3.8
    networks:
      - grafana
    ports:
      - "3000:3000"
    environment:
      - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTH_BASIC_ENABLED=false
    volumes:
      - ./grafana:/etc/grafana/provisioning/
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
    ports:
      - "9090:9090"
    networks:
      - grafana
  influxdb:
    image: influxdb:1.8
    networks:
      - grafana
    ports:
      - "8086:8086"
    environment:
      - INFLUXDB_DB=k6